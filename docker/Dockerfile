    FROM node:15.9.0-alpine3.12
    ARG JD_SHELL=git@github.com:849165048/jd_pro.git
    ARG JD_SHELL_BRANCH=master
    ARG KEY="-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----"
    ENV PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \
        LANG=zh_CN.UTF-8 \
        SHELL=/bin/bash \
        PS1="\u@\h:\w \$ " \
        JD_DIR=/jd \
        ENABLE_TTYD=true \
        ENABLE_WEB_PANEL=true \
        ENABLE_HANGUP=false \
        ENABLE_RESET_REPO_URL=true \
        JD_SHELL_URL=git@github.com:849165048/jd_pro.git \
        JD_SCRIPTS_URL=https://github.com/Aaron-lv/sync.git
    WORKDIR ${JD_DIR}
    RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories \
        && apk update -f \
        && apk upgrade \
        
        && apk --no-cache add -f bash \
                                 coreutils \
                                 git \
                                 wget \
                                 curl \
                                 nano \
                                 tzdata \
                                 perl \
                                 openssh-client \
				 python3 \
		                 py3-pip \
				 zlib-dev \
                                 jpeg-dev \
	&& apk add --no-cache --virtual .build \
        			 gcc \
        			 python3-dev \
        			 musl-dev \
        && rm -rf /var/cache/apk/* \
        && ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
        && echo "Asia/Shanghai" > /etc/timezone \
        && mkdir -p /root/.ssh \
        && echo -e $KEY > /root/.ssh/id_rsa \
        && chmod 600 /root/.ssh/id_rsa \
        && ssh-keyscan github.com > /root/.ssh/known_hosts \
        && git clone -b $JD_SHELL_BRANCH $JD_SHELL $JD_DIR \
        && npm install \
        && npm install -g pm2 \
        && ln -sf $JD_DIR/jtask.sh /usr/local/bin/jd \
        && ln -sf $JD_DIR/jtask.sh /usr/local/bin/jtask \
        && ln -sf $JD_DIR/jtask.sh /usr/local/bin/otask \
        && ln -sf $JD_DIR/jtask.sh /usr/local/bin/mtask \
        && ln -sf $JD_DIR/jup.sh /usr/local/bin/git_pull \
        && ln -sf $JD_DIR/jup.sh /usr/local/bin/jup \
        && ln -sf $JD_DIR/jlog.sh /usr/local/bin/rm_log \
        && ln -sf $JD_DIR/jlog.sh /usr/local/bin/jlog \
        && ln -sf $JD_DIR/jcode.sh /usr/local/bin/export_sharecodes \
        && ln -sf $JD_DIR/jcode.sh /usr/local/bin/jcode \
        && ln -sf $JD_DIR/jcsv.sh /usr/local/bin/jcsv \
	&& ln -sf /usr/bin/python3 /usr/bin/python \
        && pip3 install --upgrade pip \
        && cd $JD_DIR/jbot \
        && pip3 install -r requirements.txt \
        && cp -f $JD_DIR/docker/docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh \
        && chmod 777 /usr/local/bin/docker-entrypoint.sh \
        && chmod 777 $JD_DIR/*.sh \
        && rm -rf /root/.npm \
	&& apk del .build \
        && rm -rf /root/.cache \
	&&  npm i -g ttyd \
	&& npm i -S png-js \
        && npm i -g cnpm \
        && cnpm i \
        && cnpm i -g typescript  \
        && cnpm i -g ts-node \
	&& npm install crypto -g \
	&& npm install -g agentkeepalive \
        && npm install -g npm \
        && npm install -g vue-cli \
        && pip3 install requests
    WORKDIR ${JD_DIR}/app
    RUN yarn
    EXPOSE 6789
    CMD [ "node", "index.js" ]
    WORKDIR ${JD_DIR}
    ENTRYPOINT ["docker-entrypoint.sh"]
